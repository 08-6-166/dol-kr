:: Widgets Orgasm [widget]

<<widget "orgasm">>
	<<if $player.penisExist and $penissize is -2>>
		<<set $femaleclimax to 1>>
	<<elseif $femaleclimax isnot -1 and $orgasmdown lt 0>>
		<<set $femaleclimax to -1>>
	<</if>>
	<<orgasmstat>><<set $orgasmcount += 1>><<set $orgasmdown to 3>>
	<<if $combat is 1>>
		<<set $speechcum to 1>><<set $speechorgasmcount += 1>>
	<</if>>
	<<if $player.penisExist and $femaleclimax is -1 and $penissize lt 0>>
		<<set $_femaleclimaxchance to 50>>
		<<if $anusstate is "penetrated" or $anusstate is "tentacle" or $anusstate is "tentacledeep">>
			<<set $_femaleclimaxchance += 40>>
		<</if>>
		<<if $mouthstate is "penetrated" or $mouthstate is "tentacle" or $mouthstate is "tentacledeep">>
			<<set $_femaleclimaxchance += 20>>
		<</if>>
		<<if $penisstate is "penetrated" or $penisstate is "otheranus" or $penisstate is "tentacledeep" or $penisstate is "tentacle">>
			<<set $_femaleclimaxchance -= 40>>
		<</if>>
		<<if random(1, 100) lte $_femaleclimaxchance>>
			<<set $femaleclimax to 1>>
		<<else>>
			<<set $femaleclimax to 0>>
		<</if>>
	<</if>>
	<<if $player.penisExist>>
		<<if $femaleclimax is 1>>
			<span class="pink">당신은 몸의 감각과 절정에 계집애처럼 굴복한다.</span>
			<<semenvolume -1>>
		<<elseif $semen_volume is 0 or $semen_amount is 0>>
			<span class="pink">You are overcome by sensation and climax, but nothing comes out.</span>
			<<set $femaleclimax to 1>>
			<<semenvolume -1>>
		<<else>>
			<<set $player.bodyliquid.penis.semen += 1>>
			<<if $player.condom>>
				<<if $player.condom.damaged is true or ($player.condom.cum is true and random(0,100) gte 95)>>
					<<set _condom to "damaged">>
				<<else>>
					<<set _condom to true>>
				<</if>>
			<</if>>
			<<if $parasite.penis.name>>
				당신은 몸의 감각에 굴복하여 자지에 달라붙은 기생충 안에 사정한다.
			<<elseif _condom is true>>
				당신은 몸의 감각에 굴복하여 자지를 감싼 콘돔 안에 사정한다.
				<<set $player.condom.cum to true>>
			<<elseif $penisuse is "othervagina">>
				<<for $_i = 0; $_i lt $enemyno; $_i++>>
					<<if $NPCList[$_i].vagina is "penis">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 자궁 깊숙히 사정한다.</span>
						<<purity -1>><<internalejac>><<creampie "npc" "vagina">>
						<<if $abomination is 1>>
							/*ToDo: Pregnancy, figure out how the Wraith, plantpeople, etc will handle pregnancy.*/
						<<else>>
							<<recordVaginalSperm $NPCList[$_i].fullDescription "pc" "human">>
						<</if>>
					<<elseif $NPCList[$_i].vagina is "penisimminent" or $NPCList[$_i].vagina is "penisentrance">>
						<<personselect $_i>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 보지 위에 사정한다.</span>
					<</if>>
				<</for>>
				<<if _condom is "damaged">>
					<span class="red">콘돔이 너무 훼손되어서, 정액이 뚫고 쏟아져 나온다.</span>
				<</if>>
			<<elseif $penisuse is "otheranus">>
				<<for $_i = 0; $_i lt $enemyno; $_i++>>
					<<if $NPCList[$_i].penis is "otheranus">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 장 속 깊숙한 곳에 사정한다.</span>
						<<purity -1>><<internalejac>><<creampie "npc" "anus">>
					<<elseif $NPCList[$_i].penis is "otheranusimminent" or $NPCList[$_i].penis is "otheranusentrance">>
						<<personselect $_i>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 엉덩이에 사정한다.</span>
					<</if>>
				<</for>>
				<<if _condom is "damaged">>
					<span class="red">콘돔이 너무 훼손되어서, 정액이 뚫고 쏟아져 나온다.</span>
				<</if>>
			<<elseif $penisuse is "othermouth">>
				<<for $_i = 0; $_i lt $enemyno; $_i++>>
					<<if $NPCList[$_i].mouth is "penis">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 입 안에 사정한다.</span>
						<<purity -1>><<internalejac>><<creampie "npc" "mouth">>
					<<elseif $NPCList[$_i].mouth is "penisimminent" or $NPCList[$_i].mouth is "penisentrance">>
						<<personselect $_i>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 얼굴에 사정한다.</span>
					<</if>>
				<</for>>
				<<if _condom is "damaged">>
					<span class="red">콘돔이 너무 훼손되어서, 정액이 뚫고 쏟아져 나온다.</span>
				<</if>>
			<<elseif $penisuse is "otherpenis">>
				<<for $_i = 0; $_i lt $enemyno; $_i++>>
					<<if $NPCList[$_i].penis is "penis">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 자지 위에 사정한다.</span>
						<<purity -1>><<internalejac>><<creampie "npc" "mouth">>
					<<elseif $NPCList[$_i].penis is "penisimminent" or $NPCList[$_i].penis is "penisentrance">>
						<<personselect $_i>>
						<span class="pink">당신은 몸의 감각에 굴복하여 <<his_yi>> 자지와 배 위에 사정한다.</span>
					<</if>>
				<</for>>
				<<if _condom is "damaged">>
					콘돔을 사용하고 있지만, 콘돔이 너무 훼손되어서 정액이 빠져나오는 것을 막을 수가 없다.
				<</if>>
			<<elseif $penisuse is "tentacle">>
				<<if $penisstate isnot "tentacleentrance" and $penisstate isnot "tentacleimminent">>
					<<penileejacstat>>
					<span class="pink">당신은 몸의 감각에 굴복한다. <<trTentacle $tentaclePenis "이">> 당신의 정액을 짜낸다.</span>
					<<purity -1>><<internalejac>><<creampie "npc" "tentacle">>
				<<else>>
					<span class="pink">당신은 몸의 감각에 굴복하여 <<trTentacle $tentaclePenis>>에 사정한다.</span>
				<</if>>
			<<elseif $mouth is "mpenisentrance">>
				<span class="pink">
					당신은 몸의 감각에 굴복한다. 자지에서 정액이 폭발하듯 터져나와 당신의
					얼굴<<if $rng gte 10 and $semen_amount gt ($semen_volume / 24) * 18>>과 머리카락<<set $player.bodyliquid.hair.semen += 1>><</if>>을 뒤덮는다.
				</span>
				<<if $semen_amount gt ($semen_volume / 24) * 18>>
					<<set $player.bodyliquid.face.semen += 1>>
				<</if>>
			<<elseif $mouth is "mpenis">>
				<<if $selfsuckDepth gte 2>>
					<span class="pink">당신은 몸의 감각에 굴복한다. 정액의 파도가 당신의 자지에서 솟구쳐 당신의 목구멍 안으로 똑바로 흘러내려간다.</span>
				<<else>>
					<span class="pink">당신은 몸의 감각에 굴복하고, 자신의 입 안에 사정되어, 어쩔 수 없이 사정한 정액을 재빨리 전부 삼킨다.</span>
				<</if>>
				<<set $player.bodyliquid.mouth.semen += 1>>
			<<elseif $worn.genitals.type.includes("chastity")>>
				<span class="pink">당신은 몸의 감각에 굴복한다. 정액의 파도가 당신의 자지에서 <<worn_genitals_name>> 안으로 분출한다.</span>
			<<elseif $leftarm is "mpenisentrance" or $rightarm is "mpenisentrance">>
				<<if $leftarm is "mpenisentrance" and $semen_amount gte random(500,1500)>>
					<<set $leftFingersSemen to 1>>
					<<set $_hand to "왼손">>
				<</if>>
				<<if $rightarm is "mpenisentrance" and $semen_amount gte random(500,1500)>>
					<<set $rightFingersSemen to 1>>
					<<set $_hand to ($_hand is undefined ? "오른손" : "양손")>>
				<</if>>
				<span class="pink">당신은 몸의 감각에 굴복한다. 정액의 파도가 당신의 자지에서 솟구<<if $_hand>>쳐, 그 중 일부가 당신의 $_hand에 떨어진다<<else>>친다<</if>>.</span>
			<<else>>
				<span class="pink">당신은 몸의 감각에 굴복한다. 정액의 파도가 당신의 자지에서 솟구친다.</span>
			<</if>>
			<<if $semen_amount lte ($semen_volume * (6 / 24))>>
				<span class="pink">기진맥진한 탓에, 당신의 몸은 묽은 정액 몇 방울만을 내보내고 만다.</span>
				<<semenvolume -2>>
			<<elseif $semen_amount lte ($semen_volume * (12 / 24))>>
				<span class="pink">몸을 혹사시켜 피곤한 탓에, 당신의 정액은 묽고 옅다.</span>
				<<semenvolume -1>>
			<<elseif $semen_amount lte ($semen_volume * (18 / 24))>>
				<span class="pink">반복된 절정으로 인한 대가를 치루듯, 몸에서 만들어지는 정액량이 감소한다.</span>
				<<semenvolume -1>>
			<</if>>

		<</if>>
	<<else>>
		<span class="pink">당신은 몸의 감각과 절정에 굴복한다.</span>
	<</if>>

	<<if $arousalmasochism/$arousal gte 0.70>>
	<!-- If over 70% arousal is from pain, PC has added reaction NG v2.7 -->
		<span class="green"> 당신은 몸부림을 치며 더 큰 고통을 갈구한다.</span>
		<<set $masochism += 5>>
	<</if>>

	<<if $masturbation_bowl is 1>><<set _liquid_collection_text to []>><</if>>
	<<if $player.penisExist>>
		<<semenOrgasm>>/*Makes changes to semen values*/
	<</if>>
	<<if $player.vaginaExist>>
		<<vaginaFluidOrgasm>>
		<<if _lube_released gt 10>>
			<span class="pink">애액이 당신의 <<pussyPost>>에서 솟구친다.</span>
		<<elseif _lube_released gt 0>>
			<span class="pink">애액이 당신의 <<pussyPost>>에서 새어나온다.</span>
		<</if>>
	<</if>>

	<<if $parasite.left_ear.name is "slime" and $parasite.right_ear.name is "slime">>
		<span class="blue">진정되는 온기가 몸을 가득 채운다.</span>
		세상사 모든 근심을 다 잊을 수 있을 것만 같은 기분이다. 당신은 이것이 양쪽 귀에 들어간 슬라임이 절정을 느낀 것에 대해 포상을 내린 것임을 알아차린다.
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -12>><<stress -12>><<set $corruption_slime += 2>>
		<br>
	<<elseif $parasite.left_ear.name is "slime">>
		<span class="blue">진정되는 온기가 몸을 가득 채운다.</span>
		세상사 모든 근심을 다 잊을 수 있을 것만 같은 기분이다. 당신은 이것이 왼쪽 귀에 들어간 슬라임이 절정을 느낀 것에 대해 포상을 내린 것임을 알아차린다.
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -6>><<stress -6>><<set $corruption_slime += 1>>
		<br>
	<<elseif $parasite.right_ear.name is "slime">>
		<span class="blue">진정되는 온기가 몸을 가득 채운다.</span>
		세상사 모든 근심을 다 잊을 수 있을 것만 같은 기분이다. 당신은 이것이 오른쪽 귀에 들어간 슬라임이 절정을 느낀 것에 대해 포상을 내린 것임을 알아차린다.
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -6>><<stress -6>><<set $corruption_slime += 1>>
		<br>
	<</if>>

	<!-- This code is orphaned, the $swarmchestgrab variable is not referenced or set in any other file -->
	<<if $swarmchestgrab gte 1>>
		<span class="pink">당신의 몸이 경련을 일으켜 <<trSwarm _swarmcreature "을">>_trResult 가슴팍에서 튕겨낸다.</span>
		<<set $swarmchestgrab to 0>>
	<</if>>

	<<if $orgasmcount lte 1>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -4000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -8000>>
		<</if>>
		<span class="pink">당신은 갑작스럽게 터져나오는 쾌락에 몸을 떤다.</span>
	<<elseif $orgasmcount lte 2>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -5000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -9000>>
		<</if>>
		<span class="pink">당신은 갑작스럽게 터져나오는 쾌락에 몸을 떤다.</span>
	<<elseif $orgasmcount lte 3>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -6000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">당신은 갑작스럽게 터져나오는 쾌락에 몸을 떤다.</span>
	<<elseif $orgasmcount lte 4>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -7000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">당신은 갑작스럽게 터져나오는 쾌락에 몸을 떤다.</span>
	<<elseif $orgasmcount lte 5>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -8000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">몸에서 힘이 다 빠진다.</span>
	<<elseif $orgasmcount lte 6>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -7000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">더는 나올 것도 없다고 생각했으나, 당신은 격렬하게 가버린다.</span>
	<<elseif $orgasmcount lte 7>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -6000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">더는 나올 것도 없다고 생각했으나, 당신은 격렬하게 가버린다.</span>
	<<elseif $orgasmcount lte 8>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -5000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">더는 나올 것도 없다고 생각했으나, 당신은 격렬하게 가버린다.</span>
	<<elseif $orgasmcount lte 9>>
		<<if $drugged gte 1>>
			<<arousal -4000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">반복된 절정으로 몸이 혹사당하고 있다.</span>
	<<elseif $orgasmcount lte 10>>
		<<if $drugged gte 1>>
			<<arousal -3000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">반복된 절정으로 몸이 혹사당하고 있다.</span>
	<<elseif $orgasmcount lte 11>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">반복된 절정으로 몸이 혹사당하고 있다.</span>
	<<elseif $orgasmcount lte 18>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>>
		<span class="pink">반복된 절정으로 몸에 가해지는 부담감이 매우 크다. 더는 가버리고 싶지 않다.</span>
	<<elseif $orgasmcount lte 23>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>><<combattrauma 10>>
		<span class="pink">당신의 정신과 신체는 계속되는 절정에 굴복한다.</span>
	<<else>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<set $drugged -= 20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>><<combattrauma 10>><<set $pain += 5>>
		<span class="red">단기간에 너무 많은 절정을 느껴버려 더는 그런 행위로부터 즐거움을 느끼지 못하게 되어버렸다. 신체적으로나 정신적으로나 고통스럽기만 하다.</span>
	<</if>>
	<!-- Chance to get dick drunk after 3rd orgasm, chance is 45% and +5% for each following orgasm, unless under effect of aphrodisiacs -->
	<<set $rng to random(1, 100)>>
	<<if $player.vaginaExist and $orgasmcount gte 3 and $orgasmcount lte 8>>
		<<if $drugged gt 0 or ($consensual and $orgasmcount / 0.2 + 30 gte $rng)>>
			<<set $drunk += 25>>
			<<switch random(1, 3)>>
				<<case 1>><span class="pink"> 당신은 어지럽다.</span>
				<<case 2>><span class="pink"> 당신은 현기증을 느낀다.</span>
				<<case 3>><span class="pink"> 당신은 똑바로 생각할 수 없다.</span>
			<</switch>>
		<</if>>
	<</if>>
	<!-- If came while being choked -->
	<<if $neckuse is "hand" and $oxygen lt $oxygenmax>>
		<<set $chokeorgasm += 1>>
		<<if $chokeorgasm gte 35 and $choketrait isnot 1>>
			<<set $choketrait = 1>>
			<br><span class="green">당신은 당신이 호흡할 수 없을 때 당신의 오르가즘이 더 강렬하고 당신이 그것을 좋아한다고 느낀다.</span>
		<</if>>
	<</if>>
	<br><br>
	<<if $orgasmtrait gte 1>>
		<<set $stress -= 100>>
	<</if>>

	<<set $orgasmcurrent += 1>>
	<<wetnessCalculate>>

	<<if $masturbation_bowl is 1>>
		<<if $masturbation_milk gt 0>>
			<<set _liquid_collection_text.push($masturbation_milk.toFixed(1) + " mL의 모유")>><<set $_milkpost to 1>>
		<</if>>
		<<if _liquid_collection_text.length gte 3>>
			<span class="gold">당신은 _liquid_collection_text[0], _liquid_collection_text[1], 그리고 _liquid_collection_text[2]를 얻었다.</span>
		<<else>>
			<span class="gold">당신은 <<print _liquid_collection_text.join("과 ")>><<print ($_milkpost eq 1?"를":"을")>> 얻었다.</span>
		<</if>>
		<br>
	<</if>>
<</widget>>

<<widget "orgasmstreet">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if $daystate isnot "night">>
			당신은 경련이 잦아들자 몸을 추스리며, 발가벗은 상태에서 낸 소리로 인해 숨은 장소가 발각되지 않았기만을 바란다.
		<<else>>
			당신은 경련이 잦아들자 몸을 추스리며, 발가벗은 상태에서 낸 소리가 누군가의 관심을 끌지는 않았기만을 바란다.
		<</if>>
	<<else>>
		<<if $daystate isnot "night">>
			왠 <<girlPost "이">> 경련하며 가버리는 소리는 사람들의 이목을 끈다. 당신이 몸의 통제권을 되찾자 사방에서 사람들이 쳐다보고 있는 것을 알아챈다. 당신을 얼굴을 붉히고는 그 자리에서 도망친다.
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<else>>
			당신은 경련이 잦아들자 몸을 추스리며, 자신이 낸 소리가 누군가의 관심을 끌지는 않았기만을 바란다.
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "orgasmforest">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if $daystate isnot "night">>
			당신은 경련이 잦아들자 나무를 붙잡고 몸을 추스린다.
		<<else>>
			당신은 경련이 잦아들자 나무를 붙잡고 몸을 추스린다.
		<</if>>
	<<else>>
		<<if $daystate isnot "night">>
			당신은 경련이 잦아들자 나무를 붙잡고 몸을 추스린다.
		<<else>>
			당신은 경련이 잦아들자 나무를 붙잡고 몸을 추스린다.
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "orgasmbeach">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if $daystate isnot "night">>
			당신은 경련이 잦아들자 몸을 추스리며, 발가벗은 상태에서 낸 소리로 인해 숨은 장소가 발각되지 않았기만을 바란다.
		<<else>>
			당신은 경련이 잦아들자 몸을 추스리며, 해수욕장에서 발가벗고 있다는 것을 자각한다.
		<</if>>
	<<else>>
		<<if $daystate isnot "night">>
			왠 <<girlPost "이">> 경련하며 가버리는 소리는 사람들의 이목을 끈다. 당신이 몸의 통제권을 되찾자 해변의 사방에서 사람들이 쳐다보고 있는 것을 알아챈다. 당신을 얼굴을 붉히고는 그 자리에서 도망친다.
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<else>>
			당신은 경련이 잦아들자 몸을 추스리며, 야외 해수욕장에서 발가벗고 있다는 것을 자각한다.
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "breastfeed">>
	<<set $_milk_released to random(10, 50)>>
	<<if $cow gte 6>>
		<<set $_milk_released *= 2>>
	<</if>>
	<<set $_milk_released /= 10>>
	<<set $_milk_released to parseFloat($_milk_released.toFixed(1))>>

	/* if the player doesn't have enough milk, set $_milk_released to whatever they have left */
	<<if $milk_amount lt $_milk_released>>
		<<set $_milk_released to $milk_amount>>
	<</if>>
	<<set $milk_produced_stat += Math.trunc($_milk_released)>>

	<<milkvolume 1>>

	<<if $masturbation_bowl is 1 and $worn.upper.exposed gte 2 and $worn.under_upper.exposed gte 1>>
		<<set $masturbation_milk += $_milk_released>>
		<!-- If the player is using both hands, only print this text the second time, and report the total milk released this turn -->
		<<set _milk_this_turn to (_milk_this_turn is undefined ? $_milk_released : _milk_this_turn + $_milk_released)>>
		<!-- $args[0] is how many times this widget has been called this turn -->
		<<if $args[0] and $args[0] is _handsOnBreasts>>
			<span class="gold">당신은 <<print (_milk_this_turn).toFixed(1)>> mL의 모유를 얻었다.</span>
		<</if>>
	<</if>>

	<<set $milk_amount -= $_milk_released>>
<</widget>>

<<widget "orgasmHourlyRecovery">>
	<<if $purity gte 990>>
		<<set $orgasmcount -= 1>>
	<<else>>
		<<set _orgmod to Math.floor((1100-$purity)/100)>>
		<<set _orgmod to Math.clamp(_orgmod, 2, 11)>>
		<<set $orgasmcount -= _orgmod>>
	<</if>>
	<<if $cow gte 6>>
		<<semenvolume 1>>
		<<milkvolume 1>>
	<</if>>
	<<if $player.penisExist>>
		<<if $arousal gte $arousalmax * (4/5)>>
			<<set $_semen_gain to Math.floor($semen_volume * (3/24))>>
		<<elseif $arousal gte $arousalmax * (3/5)>>
			<<set $_semen_gain to Math.floor($semen_volume * (2/24))>>
		<<else>>
			<<set $_semen_gain to Math.floor($semen_volume * (1/24))>>
		<</if>>
		<<if $cow gte 6>>
			<<set $_semen_gain *= 2>>
		<</if>>
		<<if $drugged gte 1>>
			<<set $_semen_gain += Math.floor($semen_volume * (1/24))>>
		<</if>>
		<<set $semen_amount += $_semen_gain>>
		
		<<if $semen_amount gt $semen_volume>>
			<<if $arousal gte $arousalmax * (4/5)>>
				<<semenvolume 2>>
			<<elseif $arousal gte $arousalmax * (3/5)>>
				<<semenvolume 1>>
			<</if>>
			<<if $drugged gte 1>>
				<<semenvolume 1>>
			<</if>>
			<<set $semen_amount to $semen_volume>>
		<</if>>
	<</if>>
	<<set $milk_amount += Math.floor(($milk_volume / 24))>>
<</widget>>

<<widget "semenOrgasm">>
	<<set $_semen_released to 30>>
	<<set $_semen_released += ($semen_volume / 30)>>
	<<if $femaleclimax is 1>>
		<<set $_semen_released /= 30>>
	<</if>>
	<<if $orgasmtrait gte 1>>
		<<set $_semen_released *= 2.5>>
	<</if>>
	<<if $cow gte 6>>
		<<set $_semen_released *= 2>>
	<</if>>

	/* if the player doesn't have enough semen, set $_semen_released to whatever they have left */
	<<if $semen_amount lt $_semen_released>>
		<<set $_semen_released to $semen_amount>>
	<</if>>

	<<set $_semen_released to parseFloat($_semen_released.toFixed(1))>>

	<<if $masturbation_bowl is 1 and $semen_amount gte 1 and $worn.under_lower.vagina_exposed is 1 and $worn.lower.vagina_exposed is 1 and $mouth isnot "mpenis">>
		<<set $masturbation_semen += $_semen_released>>
		<<set _liquid_collection_text.push($masturbation_semen.toFixed(1) + " mL의 <<semenPost>>")>><<set $_milkpost to 0>>
	<</if>>

	<<if $femaleclimax isnot 1>>
		<<semenvolume 1>>
	<</if>>

	<<set $semen_produced_stat += $_semen_released>>
	<<set $semen_amount -= $_semen_released>>
<</widget>>

<<widget "wetnessCalculate">>
	<<if $player.vaginaExist>>
		<<vaginaWetnessCalculate>>
	<</if>>
	<<if $player.penisExist>>
		<<set $penisWetness to setup.bodyliquid.combined("penis") * 12>>
		<<set $penisWetness to Math.clamp($penisWetness, 0, 120)>>
	<</if>>
	<<set $anusWetness to (setup.bodyliquid.combined("anus") + setup.bodyliquid.combined("bottom")) * 6>>
	<<set $anusWetness to Math.clamp($anusWetness, 0, 120)>>
	<<if $combat is 1>>
		<<penetrationPainCalculate>>
	<</if>>
<</widget>>

<<widget "vaginaWetnessCalculate">>
<<set _totalArousal = 0>>
<<set _length to $trackedArousal.length>>
<<for _ia to 0; _ia lt _length; _ia++>>
	<<set _totalArousal += $trackedArousal[_ia] / ((_length - _ia) * 1.5)>>
<</for>>
<<if $combat is 1>>
	<!-- combatWetBoost can be from 0 to 5, because max promiscuity/deviancy is 100. -->
	<<if $enemytype is "man">>
		<<set $combatWetBoost to Math.floor($promiscuity /20)>>
	<<elseif $enemytype is "tentacles" or $enemytype is "beast">>
		<<set $combatWetBoost to Math.floor($deviancy /20)>>
	<<else>>
		<<set $combatWetBoost to 0>>
	<</if>>
	<!-- combatArousalWetness has been replaced by vaginaArousalWetness but I don't want to remove it completely so it's commented out for now. -->
	/* <<set $_combatArousalWetness to 75 - Math.floor(Math.pow(0.99985,_totalArousal) * 75)>> 
	<<set $combatWetBoost += $_combatArousalWetness>> */
<<else>>
	<<set $combatWetBoost to 0>>
<</if>>

<<set $vaginaWetness to $vaginaArousalWetness + $combatWetBoost + (setup.bodyliquid.combined("vagina") + setup.bodyliquid.combined("vaginaoutside")) * 6>>
<<set $vaginaWetness to Math.clamp($vaginaWetness, 0, 120)>>
<</widget>>

<<widget "penetrationPainCalculate">>
<<set $vaginalPain to 0>>
<<set $analPain to 0>>
<<set $penisPain to 0>>
<<if $demon lt 6 and $gamemode isnot "soft">>
	<<if $player.vaginaExist>>
		<<if $consensual is 1>>
			<<set $vaginalPain to Math.floor(3 * Math.pow(0.4,$vaginaWetness/8))>>
		<<else>>
			<<set $vaginalPain to Math.floor(6 * Math.pow(0.5,$vaginaWetness/25))>>
		<</if>>
	<</if>>
	<<if $player.penisExist>>
		<<if $consensual is 1>>
			<<set $penisPain to Math.floor(3 * Math.pow(0.4,$penisWetness/8))>>
		<<else>>
			<<set $penisPain to Math.floor(6 * Math.pow(0.5,$penisWetness/25))>>
		<</if>>
	<</if>>
	<<if $consensual is 1>>
		<<set $analPain to Math.floor(3 * Math.pow(0.4,$anusWetness/8))>>
	<<else>>
		<<set $analPain to Math.floor(6 * Math.pow(0.5,$anusWetness/25))>>
	<</if>>
	<<if $gamemode is "hard">>
		<<set $vaginalPain *= 2>>
		<<set $penisPain *= 2>>
		<<set $analPain *= 2>>
	<</if>>
<</if>>
<</widget>>

<!-- Lube is only released when vaginaArousalWetness is over 60 (also, its max value is 100)-->
<!-- "passive" means the lube is dripping out, while "active" means it is being pushed out  -->
<<widget "vaginaFluidPassive">>
	<<set $_lube_max to Math.round(30*Math.log10($vaginaArousalWetness - 59))>>
	<<set _lube_released to random(0, $_lube_max)/20>>
	<!-- Expected value is between 0 and 2.5, much more likely to be on the lower end due to wetness having a softcap -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<if $masturbation_bowl is 1>>
		<<set $masturbation_vaginaFluid += _lube_released>>
	<</if>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>

<<widget "vaginaFluidActive">>
	<<set $_lube_max to Math.ceil(30*Math.log10($vaginaArousalWetness - 59))>>
	<<set _lube_released to random(10, $_lube_max)/10>>
	<!-- Expected value is between 1 and 5, much more likely to be on the lower end due to wetness having a softcap  -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<if $masturbation_bowl is 1>>
		<<set $masturbation_vaginaFluid += _lube_released>>
	<</if>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>

<<widget "vaginaFluidOrgasm">>
	<<addVaginalWetness 10>>
	<<if $vaginaArousalWetness gte 60>>
		<<set _lube_released to (2*Math.log10($vaginaArousalWetness - 59)) + 11>>
	<<elseif $vaginaArousalWetness gte 30>>
		<<set _lube_released to ($vaginaArousalWetness / 10) + 5>>
	<<else>>
		<<set _lube_released to 0>>
	<</if>>
	<!-- Expected value is either 0, or between 5 and 15 -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<if $masturbation_bowl is 1 and $worn.under_lower.vagina_exposed is 1 and $worn.lower.vagina_exposed is 1>>
		<<set $masturbation_vaginaFluid += _lube_released>>
		<<set _liquid_collection_text.push($masturbation_vaginaFluid.toFixed(1) + " mL의 애액")>><<set $_milkpost to 0>>
	<<elseif $worn.under_lower.vagina_exposed is 0>>
		<<set $underlowerwet += Math.round(30 * Math.clamp((1 - $underlowerwet/100), 0, 1))>>
	<</if>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>